(()=>{"use strict";const e=window.wp.i18n,t=window.wp.element,o=window.wc.wcBlocksRegistry,n=window.wp.htmlEntities,r=window.wc.wcSettings,s=window.wc.wcBlocksData,i=window.wp.data,a=window.ReactJSXRuntime,c="finix_bank_gateway",d=(0,r.getSetting)("finix_bank_gateway_data",{}),l=(0,n.decodeEntities)(d.title)||(0,e.__)("Pay with Bank","finix-for-woocommerce"),m=e=>{const{PaymentMethodLabel:o}=e.components,n=()=>(0,t.createElement)("img",{src:d.icon});return(0,a.jsx)(o,{text:l,icon:(0,a.jsx)(n,{})})},u=o=>{const{activePaymentMethod:n,eventRegistration:r,emitResponse:a}=o,{onPaymentSetup:l,onCheckoutFail:m}=r,[u,f]=(0,t.useState)(null),[p,w]=(0,t.useState)(""),[_,y]=(0,t.useState)(""),{totals:h}=(0,i.useSelect)(e=>e(s.cartStore).getCartData(),[]),[b,g]=(0,t.useState)("");(0,t.useEffect)(()=>{g("CAD"===h.currency_code?d.merchant:d.merchant_cad)},[h]),(0,t.useEffect)(()=>{y("")},[m]),(0,t.useEffect)(()=>{const t=jQuery("input#billing-city, input#shipping-city"),o={showAddress:d.finix_form_options.showAddress||!0,showLabels:d.finix_form_options.showLabels||!0,labels:d.finix_form_options.labels||{name:(0,e.__)("Full Name","finix-for-woocommerce")},showPlaceholders:d.finix_form_options.showPlaceholders||!0,placeholders:d.finix_form_options.placeholders||{name:d.text.full_name},hideFields:d.finix_form_options.hideFields||["address_line1","address_line2","address_city","address_state"],requiredFields:d.finix_form_options.requiredFields||["name","address_country","address_postal_code"],hideErrorMessages:d.finix_form_options.hideErrorMessages||!1,errorMessages:d.finix_form_options.errorMessages||{name:(0,e.__)("Please enter a valid name","finix-for-woocommerce"),address_city:(0,e.__)("Please enter a valid city","finix-for-woocommerce")},styles:{default:{color:t.css("color"),backgroundColor:t.css("background-color"),border:`${t.css("border-width")} ${t.css("border-style")} ${t.css("border-color")}`,borderRadius:`${t.css("border-top-left-radius")} ${t.css("border-top-right-radius")} ${t.css("border-bottom-right-radius")} ${t.css("border-bottom-left-radius")}`,fontFamily:t.css("font-family"),fontWeight:t.css("font-weight"),lineHeight:t.css("line-height"),boxShadow:t.css("box-shadow"),maxHeight:"100%",appearance:"auto"},success:{},error:{color:"#d9534f",border:"1px solid rgba(255,0,0, 0.3)"}},onUpdate(e,t,o){},onLoad(){}};window.Finix.Auth(d.environment,b,e=>{w(e)});const n=c+"-form",r=(t,s=null)=>{t>4?document.getElementById(n).innerHTML="<p>"+(0,e.__)("Unfortunately, there was an error while loading the payment form. Please try again later.","finix-for-woocommerce")+"</p>":""===document.getElementById(n).innerHTML?(s=window.Finix.BankTokenForm(n,o),setTimeout(()=>{t++,r(t,s)},500)):f(s)};return r(0),()=>{}},[l]),(0,t.useEffect)(()=>{const t=l(async()=>{const t=document.querySelector('input[name="radio-control-wc-payment-method-options"]:checked').value;if(t!==c)return;if(t!==n)return;if(!u)return{type:a.responseTypes.ERROR,message:(0,e.__)("Unfortunately, there was an error while initializing a payment form.","finix-for-woocommerce")};let o={finix_fraud_session_id:p,finix_nonce:d.nonce};if(!_||""===_)try{const e=await(async()=>(document.querySelector("button.wc-block-components-checkout-place-order-button").disabled=!0,new Promise((e,t)=>{u.submit(d.environment,d.application,function(o,n){if(o)document.querySelector("button.wc-block-components-checkout-place-order-button").disabled=!1,t(o);else{const t=(n.data||{}).id;e(t)}})})))();return y(e),o[c+"_token"]=e,{type:a.responseTypes.SUCCESS,meta:{paymentMethodData:o}}}catch(e){return y(""),document.querySelector("button.wc-block-components-checkout-place-order-button").disabled=!1,{type:a.responseTypes.ERROR,message:e}}return o[c+"_token"]=_,{type:a.responseTypes.SUCCESS,meta:{paymentMethodData:o}}});return()=>t()},[l,u,a.responseTypes.SUCCESS,a.responseTypes.ERROR,p]);const x=jQuery("#billing-city").outerHeight()+"px !important"||0;return(0,t.createElement)("fieldset",{id:"wc-"+c+"-form",className:"finix-wc-form wc-payment-form"},(S=d.description)&&""!==S.trim()?(0,t.createElement)("div",{},(0,t.createElement)("p",{dangerouslySetInnerHTML:{__html:d.description}})):null,(0,t.createElement)("div",{id:c+"-form"}),(0,t.createElement)("style",{},`\n\t          .finix-wc-form iframe {\n\t              height: ${x};\n\t          }\n            `));var S},f=()=>{};(0,o.registerPaymentMethod)({name:c,label:(0,a.jsx)(m,{}),content:(0,a.jsx)(u,{}),edit:(0,a.jsx)(f,{}),canMakePayment:()=>!0,ariaLabel:l,supports:{features:d.supports}})})();