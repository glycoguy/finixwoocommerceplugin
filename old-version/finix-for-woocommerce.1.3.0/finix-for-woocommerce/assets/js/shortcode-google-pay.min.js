function retrieveBillingData(){let e={};return document.querySelector("#billing_country")&&document.querySelector("#billing_email")?(e={first_name:document.querySelector("#billing_first_name")?.value||"",last_name:document.querySelector("#billing_last_name")?.value||"",address1:document.querySelector("#billing_address_1")?.value||"",city:document.querySelector("#billing_city")?.value||"",postcode:document.querySelector("#billing_postcode")?.value||"",country:document.querySelector("#billing_country")?.value||"",state:"hidden"!==document.querySelector("#billing_state")?.type&&document.querySelector("#billing_state")?.value||"",email:document.querySelector("#billing_email")?.value||""},document.querySelector("#billing_phone")?.closest("p.form-row")?.classList.contains("validate-required")&&(e.phone=document.querySelector("#billing_phone")?.value||"")):e={first_name:finix_google_pay_params.billing_data.first_name,last_name:finix_google_pay_params.billing_data.last_name,address1:finix_google_pay_params.billing_data.address_1,city:finix_google_pay_params.billing_data.city,postcode:finix_google_pay_params.billing_data.postcode,country:finix_google_pay_params.billing_data.country,state:finix_google_pay_params.billing_data.state,email:finix_google_pay_params.billing_data.email,phone:finix_google_pay_params.billing_data.phone},e}function retrieveShippingData(){var e,o,t,i,a,n=retrieveBillingData();return""===n.address1||""===n.city||"US"===n.country&&""===n.state||""===n.postcode||""===n.country?(triggerGooglePaySubmitError(finix_google_pay_params.text.error_billing),!1):(e=document.querySelector("#shipping_country")?.value||"",o=document.querySelector("#shipping_state")?.value||"",t=document.querySelector("#shipping_postcode")?.value||"",i=document.querySelector("#shipping_city")?.value||"",a=document.querySelector("#shipping_address_1")?.value||"",n={shipping_country:n.country,shipping_state:n.state,shipping_postcode:n.postcode,shipping_city:n.city,shipping_address_1:n.address1},nonEmptyValue(e)&&(n.shipping_country=e),nonEmptyValue(o)&&(n.shipping_state=o),nonEmptyValue(t)&&(n.shipping_postcode=t),nonEmptyValue(i)&&(n.shipping_city=i),nonEmptyValue(a)&&(n.shipping_address_1=a),n)}function triggerGooglePaySubmitError(e){var o=jQuery("form.woocommerce-checkout, form#order_review");void 0!==e&&0!==e.length||(e='<div class="woocommerce-error">'+finix_params.text.error_processing+"</div>"),jQuery(".woocommerce-NoticeGroup-checkout, .woocommerce-error, .woocommerce-message, .is-error, .is-success").remove(),o.prepend('<div class="woocommerce-NoticeGroup woocommerce-NoticeGroup-checkout">'+e+"</div>"),o.removeClass("processing").unblock(),o.find(".input-text, select, input:checkbox").trigger("validate").trigger("blur");let t=jQuery(".woocommerce-NoticeGroup-updateOrderReview, .woocommerce-NoticeGroup-checkout");t.length||(t=o),jQuery.scroll_to_notices(t),o.find('.woocommerce-error[tabindex="-1"], .wc-block-components-notice-banner.is-error[tabindex="-1"]').trigger("focus"),jQuery(document.body).trigger("checkout_error",[e])}function onGooglePayLoaded(){FinixGooglePay.getPaymentsClient().isReadyToPay(FinixGooglePay.getIsReadyToPayRequest()).then(function(e){e.result&&(addGooglePayButton(),FinixGooglePay.prefetch())}).catch(function(e){})}function validateWhetherGooglePaySelected(){var e;jQuery('input[name="payment_method"]:checked').val()===finix_google_pay_params.gateway&&(e=document.getElementById("wc-finix_google_pay_gateway-form"))&&"block"!==e.style.display&&(onGooglePayLoaded(),e.style.display="block")}function addGooglePayButton(){var e=FinixGooglePay.getPaymentsClient().createButton({onClick:onGooglePaymentButtonClicked,allowedPaymentMethods:[FinixGooglePay.getCardMethod()],buttonColor:finix_google_pay_params.button_color,buttonType:finix_google_pay_params.button_type,buttonRadius:finix_google_pay_params.button_radius,buttonLocale:finix_google_pay_params.button_locale});finix_google_pay_params.google_merchant_id&&""!==finix_google_pay_params.google_merchant_id&&void 0!==finix_google_pay_params.google_merchant_id&&document.getElementById("wc-finix_google_pay_gateway-form").appendChild(e)}function onGooglePaymentButtonClicked(){if(finix_google_pay_params.google_merchant_id&&""!==finix_google_pay_params.google_merchant_id&&void 0!==finix_google_pay_params.google_merchant_id){var t=retrieveBillingData();if(t.first_name&&t.last_name&&t.address1&&t.city&&t.state&&t.postcode&&t.country&&t.email){let e=retrieveShippingData(),o=(nonEmptyValue(e.shipping_country)&&nonEmptyValue(e.shipping_state)&&nonEmptyValue(e.shipping_postcode)&&nonEmptyValue(e.shipping_city)&&nonEmptyValue(e.shipping_address_1)||(e={shipping_country:t.country,shipping_state:t.state,shipping_postcode:t.postcode,shipping_city:t.city,shipping_address_1:t.address1}),FinixGooglePay.getPaymentsClient());e.nonce=finix_google_pay_params.nonce,fetch(finix_google_pay_params.url.ajax+"?action=validate_shipping_method",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)}).then(e=>e.json()).then(e=>{!0===e.success?((e=FinixGooglePay.getPaymentDataRequest()).transactionInfo=FinixGooglePay.getTransactionInfo(),o.loadPaymentData(e).then(e=>{processPaymentData(e)}).catch(e=>{})):triggerGooglePaySubmitError(finix_google_pay_params.text.error_shipping)}).catch(e=>{})}else triggerGooglePaySubmitError(finix_google_pay_params.text.error_billing)}else triggerGooglePaySubmitError(finix_google_pay_params.text.error_merchant_id)}async function processPaymentData(e){var o,e=e.paymentMethodData.tokenizationData.token;e?((o=retrieveBillingData()).address2=document.querySelector("#billing_address_2")?.value||"",FinixGooglePay.processPayment(e,o).then(e=>{e&&e.success?(document.querySelector("#finix_google_pay_success").value=e.success,document.querySelector("#finix_google_pay_transaction_id").value=e.transactionId||"",jQuery("form.woocommerce-checkout, form#order_review").trigger("submit")):(triggerGooglePaySubmitError(finix_google_pay_params.text.error_processing),document.querySelector("#finix_google_pay_success").value=!1)}).catch(e=>{triggerGooglePaySubmitError(finix_google_pay_params.text.error_processing),document.querySelector("#finix_google_pay_success").value=!1})):(triggerGooglePaySubmitError(finix_google_pay_params.text.error_setting_payment),document.querySelector("#finix_google_pay_success").value=!1)}function nonEmptyValue(e){return null!=e&&""!==e&&"undefined"!==e&&""!==e.trim()}jQuery(function(){let t=jQuery("form.woocommerce-checkout, form#order_review");if(t.length){let e=0,o=setInterval(function(){validateWhetherGooglePaySelected(),5<=++e&&clearInterval(o)},1e3);jQuery(document).on("click","#place_order",async function(e){if(jQuery('input[name="payment_method"]:checked',t).val()!==finix_google_pay_params.gateway)return!0;e.preventDefault(),e.stopImmediatePropagation(),onGooglePaymentButtonClicked()}),jQuery(document).on("updated_checkout",function(){finix_google_pay_params.amount=FinixHelpers.getUpdatedTotal()})}});